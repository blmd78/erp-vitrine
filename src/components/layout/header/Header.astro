---
import Navigation from './Navigation.astro'
import ControlsDesktop from './desktop/ControlsDesktop.astro'
import Logo from './Logo.astro'
import MobileButton from './mobile/MobileButton.astro'
import MobileMenu from './mobile/MobileMenu.astro'
---

<header
	class="transition-smooth fixed top-0 right-0 left-0 z-50 bg-transparent"
	id="header"
>
	<div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
		<div
			class="transition-smooth flex h-20 items-center justify-between md:justify-between"
		>
			<!-- Logo centré sur mobile, aligné à gauche sur desktop -->
			<div
				class="flex flex-1 justify-center md:flex-none md:justify-start"
			>
				<Logo />
			</div>

			<div class="hidden items-center space-x-6 md:flex">
				<Navigation />
				<ControlsDesktop />
			</div>

			<!-- Bouton menu en position absolue sur mobile pour ne pas affecter le centrage du logo -->
			<div class="absolute right-4 md:hidden">
				<MobileButton action="open" />
			</div>
		</div>
	</div>
</header>

<!-- Mobile Menu (outside header to avoid stacking context issues) -->
<MobileMenu />

<script>
	// Header scroll effect
	const header = document.getElementById('header')

	function updateHeader() {
		if (!header) return

		const currentScrollY = window.scrollY
		const isDark = document.documentElement.classList.contains('dark')

		if (currentScrollY > 50) {
			// Scrolled down - make header solid
			header.classList.remove('bg-transparent')
			header.classList.add('backdrop-blur-sm', 'border-b')

			if (isDark) {
				header.classList.add('bg-gray-900/95', 'border-gray-700/50')
				header.classList.remove('bg-white/95', 'border-gray-100')
			} else {
				header.classList.add('bg-white/95', 'border-gray-100')
				header.classList.remove('bg-gray-900/95', 'border-gray-700/50')
			}
		} else {
			// At top - make header transparent
			header.classList.add('bg-transparent')
			header.classList.remove(
				'bg-white/95',
				'bg-gray-900/95',
				'backdrop-blur-sm',
				'border-b',
				'border-gray-100',
				'border-gray-700/50',
			)
		}
	}

	// Listen for scroll events
	window.addEventListener('scroll', updateHeader, { passive: true })

	// Listen for theme changes
	const observer = new MutationObserver(() => {
		updateHeader()
	})
	observer.observe(document.documentElement, {
		attributes: true,
		attributeFilter: ['class'],
	})

	// Listen for custom theme change events
	window.addEventListener('theme-changed', updateHeader)

	// Initial call
	updateHeader()
</script>
