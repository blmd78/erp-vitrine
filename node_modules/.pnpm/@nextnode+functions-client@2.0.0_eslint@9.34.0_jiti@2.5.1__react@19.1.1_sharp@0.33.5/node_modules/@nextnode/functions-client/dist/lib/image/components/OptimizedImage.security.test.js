import { jsx as _jsx } from "react/jsx-runtime";
/**
 * Security tests for OptimizedImage components
 * Tests URL validation and XSS prevention in background images
 * @vitest-environment jsdom
 */
import { render } from '@testing-library/react';
import { describe, expect, it } from 'vitest';
import { OptimizedBackgroundImage } from './OptimizedImage.js';
describe('OptimizedBackgroundImage URL Validation', () => {
    const createMockImage = (src) => ({
        src,
        width: 800,
        height: 600,
        format: 'jpg',
    });
    describe('javascript: protocol injection', () => {
        it('should reject javascript: protocol in image.src', () => {
            const maliciousImage = createMockImage('javascript:alert(1)');
            expect(() => render(_jsx(OptimizedBackgroundImage, { image: maliciousImage, children: "Content" }))).toThrow('Invalid image URL: javascript: protocol not allowed');
        });
        it('should reject case-insensitive javascript: protocol', () => {
            const maliciousImage = createMockImage('JaVaScRiPt:alert(1)');
            expect(() => render(_jsx(OptimizedBackgroundImage, { image: maliciousImage, children: "Content" }))).toThrow('Invalid image URL: javascript: protocol not allowed');
        });
    });
    describe('data URI validation', () => {
        it('should accept valid data:image/* URIs', () => {
            const validImage = createMockImage('data:image/png;base64,iVBORw0KGg==');
            expect(() => render(_jsx(OptimizedBackgroundImage, { image: validImage, children: "Content" }))).not.toThrow();
        });
        it('should reject data:text/html URIs', () => {
            const maliciousImage = createMockImage('data:text/html,<script>alert(1)</script>');
            expect(() => render(_jsx(OptimizedBackgroundImage, { image: maliciousImage, children: "Content" }))).toThrow('Invalid image URL: only data:image/* allowed');
        });
        it('should reject data URIs with non-image MIME types', () => {
            const maliciousImage = createMockImage('data:application/json,{}');
            expect(() => render(_jsx(OptimizedBackgroundImage, { image: maliciousImage, children: "Content" }))).toThrow('Invalid image URL: only data:image/* allowed');
        });
    });
    describe('https:// and http:// URLs', () => {
        it('should accept valid https:// URLs', () => {
            const validImage = createMockImage('https://example.com/image.jpg');
            expect(() => render(_jsx(OptimizedBackgroundImage, { image: validImage, children: "Content" }))).not.toThrow();
        });
        it('should accept valid http:// URLs', () => {
            const validImage = createMockImage('http://example.com/image.jpg');
            expect(() => render(_jsx(OptimizedBackgroundImage, { image: validImage, children: "Content" }))).not.toThrow();
        });
    });
    describe('relative paths', () => {
        it('should accept relative paths starting with /', () => {
            const validImage = createMockImage('/images/photo.jpg');
            expect(() => render(_jsx(OptimizedBackgroundImage, { image: validImage, children: "Content" }))).not.toThrow();
        });
        it('should reject relative paths without leading /', () => {
            const invalidImage = createMockImage('images/photo.jpg');
            expect(() => render(_jsx(OptimizedBackgroundImage, { image: invalidImage, children: "Content" }))).toThrow('Invalid image URL: must be data:image/*, https://, http://, or relative path');
        });
    });
    describe('CSS injection prevention', () => {
        it('should safely handle URLs with special characters', () => {
            const validImage = createMockImage('https://example.com/image%20with%20spaces.jpg');
            expect(() => render(_jsx(OptimizedBackgroundImage, { image: validImage, children: "Content" }))).not.toThrow();
        });
        it('should reject malformed URLs', () => {
            const invalidImage = createMockImage('not-a-valid-url');
            expect(() => render(_jsx(OptimizedBackgroundImage, { image: invalidImage, children: "Content" }))).toThrow('Invalid image URL: must be data:image/*, https://, http://, or relative path');
        });
    });
    describe('edge cases', () => {
        it('should handle empty string URLs', () => {
            const invalidImage = createMockImage('');
            expect(() => render(_jsx(OptimizedBackgroundImage, { image: invalidImage, children: "Content" }))).toThrow('Invalid image URL: must be data:image/*, https://, http://, or relative path');
        });
        it('should handle URLs with query parameters', () => {
            const validImage = createMockImage('https://example.com/image.jpg?w=800&h=600');
            expect(() => render(_jsx(OptimizedBackgroundImage, { image: validImage, children: "Content" }))).not.toThrow();
        });
        it('should handle URLs with fragments', () => {
            const validImage = createMockImage('https://example.com/image.jpg#section');
            expect(() => render(_jsx(OptimizedBackgroundImage, { image: validImage, children: "Content" }))).not.toThrow();
        });
    });
});
//# sourceMappingURL=OptimizedImage.security.test.js.map